<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="Pelican Static Site Generator, Powered by Python">
    <meta name="description" content="En este apunte escribo los pasos para crear certificados autofirmados para que el servidor web Apache opere cifrando las comunicaciones con SSL. Dicho de otra forma, es usar el HTTPS en lugar del HTTP.">
    <meta name="keywords" content="software libre, apuntes">
    <meta name="author" content="Guillermo Valdés Lozano (guivaloz)">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@guivaloz">
    <meta name="twitter:title" content="Crear certificados autofirmados para Apache 2">
    <meta name="twitter:description" content="En este apunte escribo los pasos para crear certificados autofirmados para que el servidor web Apache opere cifrando las comunicaciones con SSL. Dicho de otra forma, es usar el HTTPS en lugar del HTTP.">
    <meta name="twitter:image:src" content="https://movimientolibre.com/apuntes/apache2-certificados-autofirmados/apache-web-server.jpg">
    <meta property="og:title" content="Crear certificados autofirmados para Apache 2">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/apuntes/apache2-certificados-autofirmados/">
    <meta property="og:image" content="https://movimientolibre.com/apuntes/apache2-certificados-autofirmados/apache-web-server.jpg">
    <meta property="og:description" content="En este apunte escribo los pasos para crear certificados autofirmados para que el servidor web Apache opere cifrando las comunicaciones con SSL. Dicho de otra forma, es usar el HTTPS en lugar del HTTP.">
    <meta property="og:site_name" content="Movimiento Libre">
    <title>Crear certificados autofirmados para Apache 2 - Movimiento Libre</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" href="/theme/images/icon-hires.png" sizes="192x192">
    <link rel="icon" href="/theme/images/icon-normal.png" sizes="128x128">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-76x76.png" sizes="76x76">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-120x120.png" sizes="120x120">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-152x152.png" sizes="152x152">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-180x180.png" sizes="180x180">
    <link rel="alternate" href="/feeds/all.rss.xml" type="application/rss+xml" title="Movimiento Libre Full RSS Feed" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap">
    <link rel="stylesheet" href="/theme/css/movimiento-libre.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74263253-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-74263253-1');
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-md navbar-light fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand" href="/">Movimiento Libre</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navBootstrap4" aria-controls="navBootstrap4" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navBootstrap4">
                <ul class="navbar-nav mr-auto">
                    <li><a class="nav-link" href="/category/apuntes.html">Apuntes</a></li>
                    <li><a class="nav-link" href="/category/articulos.html">Artículos</a></li>
                    <li><a class="nav-link" href="/category/presentaciones.html">Presentaciones</a></li>
                    <li><a class="nav-link" href="/portafolio/contacto/index.html">Contacto</a></li>
                </ul>
                <ul class="navbar-nav movimientolibre-navbar-icons">
                    <li><a class="movimientolibre-navbar-icon-link" href="https://twitter.com/guivaloz/" target="_blank"><i class="fab fa-twitter-square"></i></a></li>
                    <li><a class="movimientolibre-navbar-icon-link" href="https://www.facebook.com/movimientolibrepuntocom/" target="_blank"><i class="fab fa-facebook-square"></i></a></li>
                    <li><a class="movimientolibre-navbar-icon-link" href="https://github.com/guivaloz" target="_blank"><i class="fab fa-github-square"></i></a></li>
                    <li><a class="movimientolibre-navbar-icon-link" href="https://movimientolibre.com/feeds/all.rss.xml"><i class="fa fa-rss-square"></i></a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <header>
            <div class="jumbotron head-welcome" itemscope itemtype="http://schema.org/Organization">
                <h1 class="jumbotron-heading head-site-name" itemprop="name">Movimiento Libre</h1>
                <p class="head-site-description" itemprop="description">Plataforma de divulgación de conocimiento libre por Ing. Guillermo Valdés Lozano (guivaloz)</p>
            </div>
        </header>
        <div class="row">
            <div class="col-sm-8">
                <article class="article-post">
                    <script type="application/ld+json">
                        {
                            "@context": "http://schema.org",
                            "@type": "Article",
                            "publisher": {
                            "@type": "Organization",
                            "name": "Movimiento Libre",
                            "logo": {
                                "@type": "ImageObject",
                                "url": "https://movimientolibre.com/theme/images/movimientolibre.png"
                            },
                            "url": "https://movimientolibre.com"
                        },
                        "author": "Guillermo Valdés Lozano (guivaloz)",
                        "name": "Crear certificados autofirmados para Apache 2",
                        "headline": "Crear certificados autofirmados para Apache 2",
                        "description": "En este apunte escribo los pasos para crear certificados autofirmados para que el servidor web Apache opere cifrando las comunicaciones con SSL. Dicho de otra forma, es usar el HTTPS en lugar del HTTP.",
                        "dateCreated": "2014-02-22 17:30:00-06:00",
                        "datePublished": "2014-02-22 17:30:00-06:00",
                        "dateModified": "2014-02-22 17:30:00-06:00",
                        "image": "https://movimientolibre.com/apuntes/apache2-certificados-autofirmados/apache-web-server.jpg",
                        "url": "https://movimientolibre.com/apuntes/apache2-certificados-autofirmados/"
                        }
                    </script>
                    <h2 class="article-post-title">Crear certificados autofirmados para Apache 2</h2>
                    <p class="article-post-meta">Guillermo Valdés Lozano (guivaloz)<br>22 febrero 2014</p>
<p>Involucrarse en el <strong>cifrado de la información</strong> que viaja a través de internet es como adentrarse a un mundo <em>bizarro</em> que es más complicado que el nuestro. Pero cada día se vuelve más importante e indispensable para cada servicio <em>web</em> que fabriquemos.</p>
<p>Podemos listar muchas razones para justificar que <strong>todos</strong> los sistemas y sitios web deberían <strong>cifrar sus datos al viajar del servidor al cliente y viceversa</strong>. Pero sólo basta una: el fin de dificultar las acciones de <em>espionaje masivo</em> al que todos estamos expuestos.</p>
<p>En este <strong>apunte</strong> escribo los pasos para <strong>crear certificados autofirmados</strong> para que el servidor web <strong>Apache</strong> opere cifrando las comunicaciones con <strong>SSL</strong>. Dicho de otra forma, es usar el <strong>HTTPS</strong> en lugar del <strong>HTTP</strong>.</p>
<h3>Advertencia</h3>
<p>Cabe aclarar que las grandes entidades, sean empresas o gobiernos, quienes tienen grandes cantidades de usuarios vía internet <strong>deberían adquirir certificados firmados por entidades más altas</strong>. Éstos certificados ya están instalados en los navegadores de internet más populares. Para verlos en <strong>Mozilla Firefox</strong> vaya a <em>Preferencias</em>, en <em>Avanzado</em>, en <em>Ver Certificados</em> y a <em>Autoridades</em>.</p>
<p>Adquirir un certificado de un proveedor de prestigio es costoso. Una alternativa es optar por generar un certificado gratuito de <a href="http://www.cacert.org/">CAcert</a>.</p>
<p>En cambio, los certificados autofirmados convienen cuando no podemos desembolsar el costo de un certificado comercial, los usuarios son pocos y confían en nosotros. La desventaja es que la primera vez que ingresen al sitio, su navegador de internet pondrá una <strong>advertencia de seguridad</strong>; a la cual debemos de indicar que el sitio <strong>sí es de confianza</strong> y guardarla para que no nos pregunte en el futuro.</p>
<h3>Procedimiento para crear certificados autofirmados</h3>
<p>Primero, como un usuario común vamos a abrir una terminal en <strong>GNU/Linux</strong> y crear un directorio donde vamos a trabajar con los certificados.</p>
<div class="highlight"><pre><span></span><code>$ mkdir apache-self-signed-cert
$ <span class="nb">cd</span> apache-self-signed-cert
</code></pre></div>


<p>Ejecute el siguiente comando <strong>openssl</strong> reemplazando el texto <em>SERVIDORSISTEMA</em> por algo que identifique el servidor y/o nombre del sistema o sitio:</p>
<div class="highlight"><pre><span></span><code>$ openssl req -x509 -nodes -days <span class="m">1460</span> -newkey rsa:2048 <span class="se">\</span>
  -keyout SERVIDORSISTEMA.key <span class="se">\</span>
  -out SERVIDORSISTEMA.crt
</code></pre></div>


<p>Este programa le preguntará datos importantes que ayudarán a identificar el certificado. En particular en <em>common name</em> use el nombre de domino completo del servidor.</p>
<div class="highlight"><pre><span></span><code><span class="n">Country</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">letter</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">AU</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="o">**</span><span class="w"></span>
<span class="k">State</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">Province</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">(</span><span class="k">full</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">Some-State</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="o">******</span><span class="w"></span>
<span class="n">Locality</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">(</span><span class="n">eg</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="err">[]:</span><span class="w"> </span><span class="o">******</span><span class="w"></span>
<span class="n">Organization</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">(</span><span class="n">eg</span><span class="p">,</span><span class="w"> </span><span class="n">company</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">Internet Widgits Pty Ltd</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="o">******</span><span class="w"></span>
<span class="n">Organizational</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">(</span><span class="n">eg</span><span class="p">,</span><span class="w"> </span><span class="k">section</span><span class="p">)</span><span class="w"> </span><span class="err">[]:</span><span class="w"> </span><span class="o">******</span><span class="w"></span>
<span class="n">Common</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">FQDN</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">YOUR</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="err">[]:</span><span class="w"> </span><span class="n">sistema</span><span class="p">.</span><span class="n">servidor</span><span class="p">.</span><span class="n">com</span><span class="w"></span>
<span class="n">Email</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="err">[]:</span><span class="w"> </span><span class="n">webmaster</span><span class="nv">@servidor</span><span class="p">.</span><span class="n">com</span><span class="w"></span>
</code></pre></div>


<p>Copie los archivos creados al directorio donde <strong>Apache</strong> espere encontrarlos. Lea la documentación de su distribución de <strong>GNU/Linux</strong> porque puede ser distinta a la que muestro a continuación que es para <a href="http://gentoo.org/">Gentoo Linux</a>:</p>
<div class="highlight"><pre><span></span><code>$ sudo cp * /etc/ssl/apache2/
</code></pre></div>


<p>Cambie los permisos de estos archivos como lo indican estos comandos:</p>
<div class="highlight"><pre><span></span><code>$ sudo chmod <span class="m">444</span> /etc/ssl/apache2/SERVIDORSISTEMA.crt
$ sudo chmod <span class="m">400</span> /etc/ssl/apache2/SERVIDORSISTEMA.key
</code></pre></div>


<p>Configure el sitio o sistema web en <strong>Apache</strong> para que haga uso del cifrado <strong>SSL</strong> creando un archivo <strong>conf</strong>. En <a href="http://gentoo.org/">Gentoo Linux</a> se usa el directorio <code>/etc/apache2/vhosts.d</code>. Consulte la documentación de su <em>distro</em> para hacerlo de la forma correcta.</p>
<div class="highlight"><pre><span></span><code>$ sudo nano /etc/apache2/vhosts.d/0443_https.conf
</code></pre></div>


<p>A continuación sigue una muestra del contenido de <code>0443_https.conf</code> que deberá de ajustar a sus necesidades:</p>
<div class="highlight"><pre><span></span><code># Escuchar el puerto 443
Listen 443

# Desde cualquier IP por el puerto 80
NameVirtualHost *:443

# Raiz
<span class="nt">&lt;VirtualHost</span> <span class="err">*:443</span><span class="nt">&gt;</span>

    # Nombre de este servidor web
    ServerName sistema.servidor.com

    # Habilitar SSL
    SSLEngine on
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
    SSLCertificateFile /etc/ssl/apache2/SERVIDORSISTEMA.crt
    SSLCertificateKeyFile /etc/ssl/apache2/SERVIDORSISTEMA.key

    # Raíz del sitio o sistema web
    DocumentRoot /var/www/htdocs
    <span class="nt">&lt;Directory</span> <span class="err">/var/www/htdocs</span><span class="nt">&gt;</span>
        Options -Indexes -FollowSymLinks
        AllowOverride all
        Order allow,deny
        Allow from all
    <span class="nt">&lt;/Directory&gt;</span>

    # Bitácoras
    ErrorLog /var/log/apache2/ssl_error_log
    <span class="nt">&lt;IfModule</span> <span class="err">log_config_module</span><span class="nt">&gt;</span>
        TransferLog /var/log/apache2/ssl_access_log
    <span class="nt">&lt;/IfModule&gt;</span>

    # OptRenegotiate
    <span class="nt">&lt;FilesMatch</span> <span class="err">&quot;\.(cgi|shtml|phtml|php)$&quot;</span><span class="nt">&gt;</span>
        SSLOptions +StdEnvVars
    <span class="nt">&lt;/FilesMatch&gt;</span>
    <span class="nt">&lt;Directory</span> <span class="err">&quot;/var/www/localhost/cgi-bin&quot;</span><span class="nt">&gt;</span>
        SSLOptions +StdEnvVars
    <span class="nt">&lt;/Directory&gt;</span>

    # ssl-accurate-shutdown
    <span class="nt">&lt;IfModule</span> <span class="err">setenvif_module</span><span class="nt">&gt;</span>
        BrowserMatch &quot;.*MSIE.*&quot; \
        nokeepalive ssl-unclean-shutdown \
        downgrade-1.0 force-response-1.0
    <span class="nt">&lt;/IfModule&gt;</span>

<span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div>


<p>La instalación de <strong>Apache</strong> en <a href="http://gentoo.org/">Gentoo Linux</a> deja por defecto el <strong>SSL</strong> deshabilitado. Así que hay que cambiar el archivo de configuración de arranque:</p>
<div class="highlight"><pre><span></span><code>$ sudo nano /etc/conf.d/apache2
</code></pre></div>


<p>Ubique la línea que define el valor <code>APACHE2_OPTS</code> y agregue <code>-D SSL</code>. Por ejemplo, para declarar el uso de <strong>PHP 5</strong> y de <strong>SSL</strong> la línea debe ser:</p>
<div class="highlight"><pre><span></span><code><span class="err">APACHE2_OPTS=&quot;-D SSL -D PHP5&quot;</span>
</code></pre></div>


<p>Guarde los cambios realizados en el archivo. Luego, arranque o reinicie el <em>daemon</em> de <strong>Apache</strong> para aplicarlos.</p>
<div class="highlight"><pre><span></span><code>$ sudo /etc/init.d/apache2 restart
</code></pre></div>


<p>Verifique que el puerto 443 esté abierto y ejecute su navegador de internet consultando la URL <code>https://localhost</code> para comprobar que funcione. No deje de revisar su <strong>muro de fuego</strong> para tener abierto el puerto 443 si necesita acceder desde otros equipos por red.</p>
<h3>Referencias</h3>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/LAMP">Arch Linux LAMP</a></li>
<li><a href="http://httpd.apache.org/docs/2.2/ssl/">Apache Documentation 2.2 SSL/TLS Encryption</a></li>
<li><a href="https://www.cacert.org/">CAcert</a></li>
</ul>
                </article>
            </div>
            <div class="col-sm-4">
                <aside>
                    <div class="card my-4 movimientolibre-card aside-about">
                        <h5 class="card-header movimientolibre-card-header">A cerca de</h5>
                        <div class="card-body">
                            <p class="card-text">
                                Este es un sitio web que busca divulgar
                                conocimiento y promover el uso de software libre.
                                Su creador es reconocido como desarrollador que
                                fabrica estas herramientas tanto para entidades
                                públicas como privadas.
                            </p>
                        </div>
                    </div>
                    <div class="card my-4 movimientolibre-card">
                        <h5 class="card-header movimientolibre-card-header">Etiquetas</h5>
                        <div class="card-body">
                            <ul class="list-unstyled mb-0">
                                <li><a href="/tag/astronomia.html">astronomía</a></li>
                                <li><a href="/tag/ciencia-de-datos.html">ciencia de datos</a></li>
                                <li><a href="/tag/conferencias.html">conferencias</a></li>
                                <li><a href="/tag/contenedores.html">contenedores</a></li>
                                <li><a href="/tag/desarrollo.html">desarrollo</a></li>
                                <li><a href="/tag/educacion.html">educación</a></li>
                                <li><a href="/tag/fedora.html">fedora</a></li>
                                <li><a href="/tag/flisol.html">flisol</a></li>
                                <li><a href="/tag/gentoo-linux.html">gentoo linux</a></li>
                                <li><a href="/tag/git.html">git</a></li>
                                <li><a href="/tag/gnu-linux.html">gnu linux</a></li>
                                <li><a href="/tag/gulag.html">gulag</a></li>
                                <li><a href="/tag/hardware.html">hardware</a></li>
                                <li><a href="/tag/kde.html">kde</a></li>
                                <li><a href="/tag/kernel-linux.html">kernel linux</a></li>
                                <li><a href="/tag/latex.html">latex</a></li>
                                <li><a href="/tag/markdown.html">markdown</a></li>
                                <li><a href="/tag/php.html">php</a></li>
                                <li><a href="/tag/politica.html">política</a></li>
                                <li><a href="/tag/postgresql.html">postgresql</a></li>
                                <li><a href="/tag/python.html">python</a></li>
                                <li><a href="/tag/ruby.html">ruby</a></li>
                                <li><a href="/tag/servidores.html">servidores</a></li>
                                <li><a href="/tag/software-libre.html">software libre</a></li>
                                <li><a href="/tag/vida-cotidiana.html">vida cotidiana</a></li>
                                <li><a href="/tag/wallpapers.html">wallpapers</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card my-4 movimientolibre-card">
                        <h5 class="card-header movimientolibre-card-header">Buscar</h5>
                        <div class="card-body">
                            <script>
                                (function() {
                                    var cx = '015464194519155410478:jqayrodgycs';
                                    var gcse = document.createElement('script');
                                    gcse.type = 'text/javascript';
                                    gcse.async = true;
                                    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                                    var s = document.getElementsByTagName('script')[0];
                                    s.parentNode.insertBefore(gcse, s);
                                })();
                            </script>
                            <gcse:search></gcse:search>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>
    <footer class="text-muted">
        <div class="container">
            <hr>
            <p>
                Copyright &copy; 2006-2020 Guillermo Valdés Lozano.
                Protegidos por la licencia <a href="/licencias/gfdl-es/">GFDL</a>.
                Se otorga permiso para copiar, distribuir y/o modificar estos documentos.
                Sitio web elaborado con <a href="https://blog.getpelican.com/">Pelican</a> que es programado en <a href="https://python.org/">Python</a>; el código fuente está en <a href="https://github.com/MovimientoLibre/plataforma.web">GitHub</a> protegido por la licencia <a href="/licencias/gpl-2-es/">GPLv3</a>.
            </p>
        </div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="/theme/js/movimiento-libre.js"></script>
</body>
</html>
